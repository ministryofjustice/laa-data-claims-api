{{- if and .Values.grafana.enabled (or (and (contains "uat" .Release.Namespace) (eq .Release.Name "main")) (and (contains "staging" .Release.Namespace)) (and (contains "prod" .Release.Namespace))) }}


apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-{{ .Chart.Name }}-perf-dashboard
  namespace: {{ .Release.Namespace }}
  labels:
    grafana_dashboard: ""
    app.kubernetes.io/managed-by: {{ .Release.Service | quote }}
  annotations:
    meta.helm.sh/release-name: {{ .Release.Name | quote }}
    meta.helm.sh/release-namespace: {{ .Release.Namespace | quote }}
data:
  {{ .Release.Name | trunc 5 }}-perf-{{ .Release.Namespace | trunc -10 }}-{{ .Chart.Name | trunc -12 }}-dashboard.json:
  {{ include "grafana-perf-dashboard-template" . | quote | indent 4 }}

{{- end }}